<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Map</title>

  <!-- CSRF -->
  <meta name="csrf-token" content="<%= form_authenticity_token %>">


<style>
.button {
      /*ã‚³ãƒ¬*/border-radius: 100px;
    display: block;
    width: 200px;
    padding: 15px;
    box-sizing: border-box;
    background: #6fa1ff;
    color: #FFF;
    text-decoration: none;
    text-align: center;
    margin: 10px 0;
    white-space: nowrap;
}
.button-container {
  display: flex;        /* å­è¦ç´ ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ */
  gap: 10px;            /* ãƒœã‚¿ãƒ³é–“ã®é–“éš” */
}
  #map {
    height: 400px;
    width: 100%;
  }
</style>

</head>




<h1>ãŠåº—ãƒãƒƒãƒ—</h1>
<div class="button-container">
<button onclick="moveCenter1()"class="button">åŒ—ä¹å·å¸‚</button>
<button onclick="moveCenter2()"class="button">ç¦å²¡å¸‚</button>
<button onclick="moveCenter3()"class="button">é£¯å¡šå¸‚</button>
<button onclick="myposition()"class="button">ç¾åœ¨åœ°</button>
</div>
<p> ç¾åœ¨åœ°å–å¾—ã§å¾’æ­©10åˆ†ä»¥å†…ã§è¡Œã‘ã‚‹ã¨ã“ã‚è¡¨ç¤º</p>
<div id="map">



<script>
let map;
let geocoder;
let marker;
let markers;

let infoWindow



const reviews = <%= raw(
  @reviews.map do |r|
    {
      id: r.id,
      storename: r.storename,
      latitude: r.latitude,
      longitude: r.longitude,
      tags: r.tags,
      image_url: r.image.attached? ? url_for(r.image) : nil,
      bookmarked: current_user ? current_user.bookmarks.exists?(review_id: r.id) : false
    }
  end.to_json
) %>;
function initMap() {
  
  

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 33.64499937514977, lng: 130.7135560801933 },
    zoom: 12,
    styles: [
ã€€ã€€
      {
        featureType: "poi.business",
        stylers: [{ visibility: "off" }]
      },
      {
        featureType: "poi.park",
        stylers: [{ visibility: "off" }]
      },
    ]
  });
  
    reviews.forEach(r => {
    const position = { lat: r.latitude, lng: r.longitude };
    const marker = new google.maps.Marker({
      position: position,
      map: map,
        icon: {
      url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
      labelOrigin: new google.maps.Point(0, 35) // â† æ–‡å­—ã‚’ä¸‹ã«
    ã€€},
      label: {
    ã€€text: r.storename,
    ã€€color: "black",
    ã€€fontSize: "15px",
    ã€€fontWeight: "bold"
  ã€€ã€€ã€€}});
  ã€€ã€€ã€€const bookmarkHTML = r.bookmarked
  ? `<form action="/reviews/${r.id}/bookmark" method="post">
       <input type="hidden" name="_method" value="delete">
       <button>ğŸ“– ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯è§£é™¤</button>
     </form>`
  : `<form action="/reviews/${r.id}/bookmark" method="post">
       <button>ğŸ“˜ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ç™»éŒ²</button>
     </form>`;
      const tagsHTML = r.tags && r.tags.length > 0
    ? '<p> ' +  r.tags.join('<br>')  + '</p> '
    : 'ãªã—';
    const imageHTML = r.image_url
  ? `<img src="${r.image_url}" style="max-width:200px; height:auto; border-radius:8px; margin-bottom:5px;">`
  : '';
    const infoWindow = new google.maps.InfoWindow({
  content: `
     <div style="max-width:220px;">
      <h3>${r.storename}</h3>
      ${imageHTML}
      <h4>ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ</h4>
      ${tagsHTML}
ã€€ã€€ã€€${bookmarkHTML}  
      
    </div>
  `
});

  marker.addListener('click', function() {
    infoWindow.open(map, marker);
  });
  
      
  });


  
  
  
  
}
function circlezoom(x){
  
}

function moveCenter1() {
  map.setCenter({ lat: 33.8869, lng: 130.8828 }); // å°å€‰é§…
}
function moveCenter2() {
  map.setCenter({ lat: 33.589825611450586, lng: 130.42086936230928 }); // å°å€‰é§…
}
function moveCenter3(){
  map.setCenter({lat: 33.64499937514977, lng: 130.7135560801933});
}
function myposition() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      const userLatLng = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      const userMarker = new google.maps.Marker({
        position: userLatLng,
        map: map,
      });

      map.setCenter(userLatLng);

      const circle = new google.maps.Circle({
        strokeColor: '#66CCFF',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#66CCFF',
        fillOpacity: 0.35,
        map: map,
        center: userLatLng,
        radius: 1000
      });

    }); 
  } else {
    alert("ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“");
  }
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm8-NU6BEgUIUIXcfxKyjYHyjOb89c4gA&callback=initMap" async defer></script>

